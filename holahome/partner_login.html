<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOLA HOME - ƒêƒÉng nh·∫≠p ƒë·ªëi t√°c</title>
    <link rel="stylesheet" href="partner_style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Login Screen (shown when not logged in) -->
    
    <div id="partner-login-screen" class="login-screen">
        <div class="login-container">
            <div class="login-logo">
                <img src="logo/balck_logo.PNG" class="house_icon" alt="HOLA HOME Logo">
                <h1>HOLA HOME</h1>
                <p>H·ªá th·ªëng qu·∫£n l√Ω ƒë·ªëi t√°c</p>
            </div>
            <div class="login-card">
                <h2>ƒêƒÉng nh·∫≠p ƒë·ªëi t√°c</h2>
                <p class="login-subtitle">D√†nh cho ch·ªß nh√† tr·ªç, cƒÉn h·ªô</p>
                <form id="partner-login-form">
                    <div class="form-group-partner">
                        <label><i class="fas fa-envelope"></i> Email ho·∫∑c Username</label>
                        <input type="text" id="partner-username" placeholder="Nh·∫≠p email ho·∫∑c username" required>
                    </div>
                    <div class="form-group-partner">
                        <label><i class="fas fa-lock"></i> M·∫≠t kh·∫©u</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="partner-password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" required>
                            <button type="button" class="toggle-password" id="toggle-password">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <div class="form-options">
                        <label class="remember-checkbox">
                            <input type="checkbox">
                            <span>Ghi nh·ªõ ƒëƒÉng nh·∫≠p</span>
                        </label>
                        <a href="#" class="forgot-link">Qu√™n m·∫≠t kh·∫©u?</a>
                    </div>
                    <button type="submit" class="btn-login-partner">
                        <i class="fas fa-sign-in-alt"></i> ƒêƒÉng nh·∫≠p
                    </button>
                </form>
                <div class="login-footer">
                    <p>Ch∆∞a c√≥ t√†i kho·∫£n ƒë·ªëi t√°c? <a href="https://forms.gle/chTTsnuNQByNDDMv8" target="_blank" id="show-register">ƒêƒÉng k√Ω ngay</a></p>
                    <p><a href="index.html"><i class="fas fa-arrow-left"></i> Quay v·ªÅ trang ch·ªß</a></p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
    // Partner Login Handler
    document.addEventListener('DOMContentLoaded', function() {
        // Toggle Password Visibility
        const togglePasswordBtn = document.getElementById('toggle-password');
        const passwordInput = document.getElementById('partner-password');
        
        if (togglePasswordBtn && passwordInput) {
            togglePasswordBtn.addEventListener('click', function() {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                
                // Toggle icon
                const icon = this.querySelector('i');
                if (type === 'password') {
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                } else {
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                }
            });
        }
        
        // Check if already logged in
        const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
        const authToken = localStorage.getItem('authToken');
        const founderToken = localStorage.getItem('founderToken');
        
        if (authToken && currentUser && currentUser.account_type === 'partner') {
            // Already logged in as partner, redirect to homepage
            window.location.href = 'index.html';
            return;
        }
        
        if (founderToken) {
            // Already logged in as founder, redirect to founder dashboard
            window.location.href = 'founder_dashboard.html';
            return;
        }
        
        const loginForm = document.getElementById('partner-login-form');
        
        if (loginForm) {
            loginForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const username = document.getElementById('partner-username').value;
                const password = document.getElementById('partner-password').value;
                const btnLogin = this.querySelector('.btn-login-partner');
                
                // Disable button during login
                btnLogin.disabled = true;
                btnLogin.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ƒêang ƒëƒÉng nh·∫≠p...';
                
                // Try partner login
                try {
                    // Call partner login API
                    const API_BASE_URL = `${window.location.origin}/api`;
                    const response = await fetch(`${API_BASE_URL}/partner/login`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            email: username,
                            password: password
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        // Save to localStorage as regular auth (with partner flag)
                        const partnerUser = {
                            id: data.partner.id,
                            email: data.partner.email,
                            username: data.partner.username || data.partner.email,
                            account_type: 'partner'
                        };
                        
                        localStorage.setItem('authToken', data.token);
                        localStorage.setItem('currentUser', JSON.stringify(partnerUser));
                        
                        // Show success
                        btnLogin.innerHTML = '<i class="fas fa-check"></i> ƒêƒÉng nh·∫≠p th√†nh c√¥ng!';
                        btnLogin.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                        
                        // Redirect to homepage after short delay
                        setTimeout(() => {
                            window.location.href = 'index.html';
                        }, 800);
                    } else {
                        // Show error
                        alert(data.error || 'ƒêƒÉng nh·∫≠p th·∫•t b·∫°i. Vui l√≤ng ki·ªÉm tra l·∫°i th√¥ng tin.');
                        btnLogin.disabled = false;
                        btnLogin.innerHTML = '<i class="fas fa-sign-in-alt"></i> ƒêƒÉng nh·∫≠p';
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    
                    // FALLBACK: Offline login for partner
                    console.log('üîÑ Backend unavailable, trying offline partner login...');
                    
                    const offlinePartners = {
                        'partner@example.com': { password: 'partner123', username: 'example_partner' },
                        'example_partner': { password: 'partner123', username: 'example_partner' }
                    };
                    
                    const partner = offlinePartners[username];
                    if (partner && partner.password === password) {
                        const partnerUser = {
                            id: 'partner#' + Date.now(),
                            email: username.includes('@') ? username : username + '@example.com',
                            username: partner.username,
                            account_type: 'partner'
                        };
                        
                        localStorage.setItem('authToken', 'offline-token-' + Date.now());
                        localStorage.setItem('currentUser', JSON.stringify(partnerUser));
                        
                        btnLogin.innerHTML = '<i class="fas fa-check"></i> ƒêƒÉng nh·∫≠p th√†nh c√¥ng!';
                        btnLogin.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                        
                        setTimeout(() => {
                            window.location.href = 'index.html';
                        }, 800);
                    } else {
                        alert('‚ùå T√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ƒë√∫ng!');
                        btnLogin.disabled = false;
                        btnLogin.innerHTML = '<i class="fas fa-sign-in-alt"></i> ƒêƒÉng nh·∫≠p';
                    }
                }
            });
        }
    });
    </script>
</body>
</html>
